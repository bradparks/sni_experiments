package org.computerist.sniexperiments;

import java.io.IOException;
import java.net.Inet4Address;
import java.net.InetAddress;
import java.net.UnknownHostException;
import java.security.KeyStore;
import java.security.KeyStoreException;
import java.security.NoSuchAlgorithmException;
import java.security.cert.CertificateException;

public class TCPServerHarness {
  public static void main(String args[]) {
    try {
      String ZAP_CA = "_u3-7QAAAAIAAAABAAAAAQARb3dhc3BfemFwX3Jvb3RfY2EAAAFB_x5l5AAABQEwggT9MA4GCisGAQQBKgIRAQEFAASCBOkBX6xB5ShkvIqZsAtIaGJ_ZjHcrD5kahdzJ6ejH8EwolI5Ey2IsjG5DSSLUfao7FRRjw-N7vbrVpQ_Dh-tkuA2fTQoH68opEnjBnN5uLz0tEqzXTgOoY5jPK55ZmL0TlaVZ6ABRscmhxH-CsnbuQmhxJU3P1G0Rva51ov5nrcyTQezHfNq4-jhwKWJ-L-eXLsqfyp0A0OmhSgNW4UsyjrGvuzq9Xh21jpgCUniBEbB4aVf2tUkcBt2A2UkDUV5Nw5wGQqtVcobUvfiVvWG0naW6Fg8CbGlt3t6R9169pmQCnUrJa_03hPgEOMdKyo8-pHxb5JKBW9B3r8quDVFuXvfya4nEv4cWZEgxdJ9ZgoDLBmje9EJOMf_crBr2XDhsWfvs6UaXq7n0O-hCzKZETANrprzhwlSQCtr7UFsfgEEB1OvAQ76C36oUw-4JqDvD7emZSLNEAd0WOEinF4Tl_jG-2vue3yjbBII-4fvmloozT45C8P8e-eKE9aL6NaoRCEwilO46ZePOrbWCdHSo_d5PYJ5IChK61vH4ZKULxLIP6_C0ttagD2LOqwrS9h0_FxedHYwAoLW_3rhY57AbPSqwpkmZ7_HwJIC9BqlvmwKo0Imm1zeEcK22Gs9MlMJSwP5qJSSTnx9r3-zySAjyy5WDBXv_6CIuG-604gkvSpkzubZ1Do3sUVoV_ASFNWFx6EYe0b8o8MsSWD6MlAH-MsxUdsm-KQMVU_lo9J4mCQPrMZnz-mFtrP3VecauztCKd-R9L9mE6WjVsM9sttthIHgWdBrqt33MV7__LIHAXsWmUVsIqlz2EoPW-JA9ghDU0vjEdzxAonxYVstgIyiHWT5IzOUjoFkl1l75ElR4UA3zEQevEw2WchAoa8KY9obZIJmWRUyXDfgf9xaYJigK1K-gCf9yTAFZ5han_WfgCZMS_tG0dEovDoE9jZZyG9r2lmvmd5QSBthhBvsaibyg-qccGmRy00eRrKDBxrr_gRJp1WR2X1fbmcIpsGxZ3GjALw8vETQsHes_5xW26SZPsp5r4Tf3RyvAtnSLzCRsbQcIQtje4icIWSx8eX-694pI8f6ll2MOnR1K-_2-ibHrGILOXD4BJNQADBOvhXvGoq1Ebw2duT7xIDD3oGaEhaZ-jT_lyrEXvIzqdRJegCqWSZ2GOZMgQoqDeI8yd1F5i3E5pHDnGC6QJKfylkYMEfpH_Xn6osZXBGzdXj1eUezLLvd5c0TVsC6yCZuqezn9KrxIggcjhyy5tQcEOvbE8Q9EbsOkKncKp5z6MkfA27KXpHwTk7WzqC48w_UdcA_TGsL6McvgSoG0sPdwdA7tAHz2hwyA4NNha_rlQIDwqaXg6jpibnrNYZXZxGM1ukk6VF8o89HDIDo6_5sp1sHiflAbOqBiQHYtxrM-42TEi4f-RHGFkmCZvi866Pd0cy32GyNw0NkWAWUvblYvM--YlMJTUQAVyfL8847DcTc6IhYClCHLu14u_fc-WahponT9lVbUkKDgB9Jv6flrFha07ciyf_7yjrqhDyQjlW7Nhi1Bsqrb09mBZO2G_9Idad7Rb3-YrGlA8pBzh0w1v8AItd6J4dPpVRfa7bsCWmxoayF4EflZP4_1sYMha5KnLQDmO03pCKIENGsl2lvENlqzWqC1g6wRd771AWGBM0AAAABAAVYLjUwOQAAA_IwggPuMIIC1qADAgECAgRuQHVYMA0GCSqGSIb3DQEBBQUAMIGFMScwJQYDVQQDDB5PV0FTUCBaZWQgQXR0YWNrIFByb3h5IFJvb3QgQ0ExGTAXBgNVBAcMEDQ3Mzc1MGYyMzY3YmJiMjgxFjAUBgNVBAoMDU9XQVNQIFJvb3QgQ0ExGjAYBgNVBAsMEU9XQVNQIFpBUCBSb290IENBMQswCQYDVQQGEwJ4eDAeFw0xMzEwMjgxMjUxMjJaFw0xNDEwMjgxMjUxMjJaMIGFMScwJQYDVQQDDB5PV0FTUCBaZWQgQXR0YWNrIFByb3h5IFJvb3QgQ0ExGTAXBgNVBAcMEDQ3Mzc1MGYyMzY3YmJiMjgxFjAUBgNVBAoMDU9XQVNQIFJvb3QgQ0ExGjAYBgNVBAsMEU9XQVNQIFpBUCBSb290IENBMQswCQYDVQQGEwJ4eDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJ_ry1s7hDdp2R5CvGJGY35gRCsBL1O9-rH8OdjuT8r0S5w0Ch_P1l0cN4Dhs-HND3yEGlZ9_7XO_UvlkidQn-FM5xtH9TTEJbqkknmRWDBztkQ20nwN_sYqbrHkTMDjqKLkTlLWUEdPo3oIh2e9a4018bC8P7lO5_Me8kXrXeOhF29aWdTUXx4ibktqveT79svB72FIsrDLRZa7vdDxj3TOSGUiTEJrLwvBFUwqsfYqOks1vUexXG8HMHW7HZtIOCl5WieOlTyl_IJ0Ix74WIBnIFpfS6k4KDMbCYCa3NOVt_La_nxRW52v-Tl27mZbTH2YB7JbSDGB_TkLOhMgpM8CAwEAAaNkMGIwHQYDVR0OBBYEFASwcQs4tunR_XA8jDZB9Tcp4-CfMA8GA1UdEwEB_wQFMAMBAf8wCwYDVR0PBAQDAgG2MCMGA1UdJQQcMBoGCCsGAQUFBwMBBggrBgEFBQcDAgYEVR0lADANBgkqhkiG9w0BAQUFAAOCAQEADrXBpuLvVNjKvsTKhWyiNMkN-fEROdynYwjRDspGXTl2t5rIgVRV0dASogFpa6BXJkQPOE9q6l55sy98hcnIpIKO6JKuN9BEoxBfRcqDCnYik783ObI_sXakYiADcr_iO9RQ6juhNSw8zhNKiyB1pwesN-vZ2D2J8ZG1IbJWkdrr0lDKG5qV5dJHLgmJk_gAeEMn0gl2Ag0E4QJ2TR6-mYOxPQtHb3bWG3Cc-BRD_tJFW3zvGV6UZEAqsUzC65xkyHjJ86UZvAvw3SRllY0kSptCRRCJQOXqTNxJfBcAWW7Nvivl0ktnPeiQfCJMi9qzVSyajPyw6T15M12MMnOi8BzJZsVt-4FwfDa_UdCuEUJOjcbi";
      InetAddress listenAddress = Inet4Address.getByName("0.0.0.0");
      int listenPort = 8443;
      InetAddress serverAddress = Inet4Address.getLocalHost();
      int serverPort = 80;

      KeyStore caks = ZapSslCertificateUtils.string2Keystore(ZAP_CA);

      SNITerminator terminator = new SNITerminator(caks, listenAddress,
          listenPort, new SingleTCPForwarder(serverAddress, serverPort));
      terminator.start();

    } catch (UnknownHostException uhe) {
      uhe.printStackTrace();
    } catch (KeyStoreException e) {
      e.printStackTrace();
    } catch (NoSuchAlgorithmException e) {
      e.printStackTrace();
    } catch (CertificateException e) {
      e.printStackTrace();
    } catch (IOException e) {
      e.printStackTrace();
    }
  }
}
